@model PaperProcessor.Models.Invoice
@using PaperProcessor.Models

@{
    ViewData["Title"] = $"Invoice {Model.InvoiceNo}";
    var wo = Model.WorkOrder;
    var customer = wo?.Customer;
}

<div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
    <div>
        <h2 class="mb-0">Invoice <span class="text-muted">@Model.InvoiceNo</span></h2>
        <div class="text-muted">
            Work Order: <strong>@(wo?.WorkOrderNo ?? "-")</strong>
        </div>
    </div>

    <div class="d-flex gap-2">
        <a class="btn btn-outline-primary" asp-action="Pdf" asp-route-id="@Model.InvoiceId">Download PDF</a>
        <a class="btn btn-outline-secondary" asp-controller="WorkOrders" asp-action="Index">Back to Work Orders</a>
    </div>
</div>

<div class="row g-3">
    <div class="col-lg-8">
        <div class="card shadow-sm mb-3">
            <div class="card-body">
                <h5 class="mb-3">Customer</h5>

                <div class="row g-2">
                    <div class="col-md-6">
                        <div class="text-muted small">Name</div>
                        <div class="fw-semibold">@((customer?.Name) ?? "-")</div>
                    </div>
                    <div class="col-md-6">
                        <div class="text-muted small">Email</div>
                        <div>@(customer?.Email ?? "-")</div>
                    </div>
                    <div class="col-md-6">
                        <div class="text-muted small">Phone</div>
                        <div>@(customer?.Phone ?? "-")</div>
                    </div>
                    <div class="col-md-6">
                        <div class="text-muted small">Address</div>
                        <div>@(customer?.Address ?? "-")</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="mb-3">Line Items</h5>

                <div class="table-responsive">
                    <table class="table table-striped align-middle">
                        <thead>
                            <tr>
                                <th>Description</th>
                                <th class="text-end">Qty</th>
                                <th class="text-end">Unit Price</th>
                                <th class="text-end">Line Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var l in Model.Lines)
                            {
                                <tr>
                                    <td>@l.Description</td>
                                    <td class="text-end">@l.Qty</td>
                                    <td class="text-end">@l.UnitPrice.ToString("0.00")</td>
                                    <td class="text-end">@l.LineTotal.ToString("0.00")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                <div class="text-muted small">Note: No GST applied.</div>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card shadow-sm mb-3">
            <div class="card-body">
                <h5 class="mb-3">Invoice Info</h5>

                <div class="mb-2">
                    <div class="text-muted small">Status</div>
                    <div class="fw-semibold">@Model.Status</div>
                </div>

                <div class="mb-2">
                    <div class="text-muted small">Issue Date</div>
                    <div>@Model.IssueDate.ToString("yyyy-MM-dd")</div>
                </div>

                <div class="mb-2">
                    <div class="text-muted small">Due Date</div>
                    <div>@Model.DueDate.ToString("yyyy-MM-dd")</div>
                </div>

                <hr />

                <div class="d-flex justify-content-between mb-1">
                    <div class="text-muted">Subtotal</div>
                    <div class="fw-semibold">@Model.Subtotal.ToString("0.00")</div>
                </div>

                <div class="d-flex justify-content-between mb-1">
                    <div class="text-muted">Discount</div>
                    <div class="fw-semibold">@Model.DiscountAmount.ToString("0.00")</div>
                </div>

                <div class="d-flex justify-content-between mt-2">
                    <div class="fw-bold">Total (No GST)</div>
                    <div class="fw-bold fs-5">@Model.Total.ToString("0.00")</div>
                </div>
            </div>
        </div>

        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="mb-2">Quick Actions</h5>

                <div class="d-grid gap-2">
                    <a class="btn btn-outline-dark"
                       asp-controller="Production"
                       asp-action="Timeline"
                       asp-route-id="@wo?.WorkOrderId">
                        View Work Order Timeline
                    </a>

                    <a class="btn btn-outline-success"
                       asp-controller="Costing"
                       asp-action="Summary"
                       asp-route-id="@wo?.WorkOrderId">
                        View Costing Summary
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
